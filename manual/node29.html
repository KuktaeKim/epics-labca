<!DOCTYPE HTML>

<!--Converted with LaTeX2HTML 2021.2 (Released July 1, 2021) -->
<HTML lang="en">
<HEAD>
<TITLE>Build</TITLE>
<META NAME="description" CONTENT="Build">
<META NAME="keywords" CONTENT="manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2021.2">

<LINK REL="STYLESHEET" HREF="manual.css">

<LINK REL="next" HREF="node30.html">
<LINK REL="previous" HREF="node28.html">
<LINK REL="next" HREF="node30.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A
 HREF="node30.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node28.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node28.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A
 HREF="node30.html">Using labCA</A>
<B> Up:</B> <A
 HREF="node28.html">Building and Using labCA</A>
<B> Previous:</B> <A
 HREF="node28.html">Building and Using labCA</A>
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A ID="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A ID="tex2html120"
  HREF="node29.html#SECTION00031100000000000000">Prerequisites</A>
<LI><A ID="tex2html121"
  HREF="node29.html#SECTION00031200000000000000">Configuration</A>
<LI><A ID="tex2html122"
  HREF="node29.html#SECTION00031300000000000000">Building <SPAN  CLASS="textbf">labCA</SPAN></A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A ID="SECTION00031000000000000000">
Build</A>
</H2>

<P>
<SPAN  CLASS="textbf">labCA</SPAN> comes with a `<SPAN style="font-family:monospace">configure</SPAN>' subdirectory and Makefiles conforming to the
EPICS build system. Following a configuration step which involves editing
two small files, '<SPAN style="font-family:monospace">make</SPAN>' is executed to install the generated libraries
and scripts.

<P>
Prior to invoking the <SPAN  CLASS="textbf">scilab</SPAN> or <SPAN  CLASS="textbf">matlab</SPAN> application, the system
must be properly set up in order for the applications to locate the
<SPAN  CLASS="textbf">labCA</SPAN> and channel access libraries.

<P>

<H3><A ID="SECTION00031100000000000000">
Prerequisites</A>
</H3>
<SPAN  CLASS="textbf">labCA</SPAN> needs an EPICS BASE installation that was built <SPAN  CLASS="textbf">with shared
libraries enabled</SPAN><A ID="tex2html11"
  HREF="#foot882"><SUP><SPAN CLASS="arabic">10</SPAN></SUP></A>.
The main reason being that <SPAN  CLASS="textbf">matlab</SPAN>'s <SPAN  CLASS="textbf">mex</SPAN> files cannot
have multiple entry points. Hence, when statically linking multiple <SPAN  CLASS="textbf">mex</SPAN>
files against <SPAN  CLASS="textbf">ezca, ca, Com</SPAN> etc. multiple copies of those libraries
would end up in the running <SPAN  CLASS="textbf">matlab</SPAN> application with possible adverse
effects. It should be possible to build and use the <SPAN  CLASS="textbf">scilab</SPAN> interface
with static libraries &mdash; minor tweaks to the Makefiles might be necessary.

<P>
<SPAN  CLASS="textbf">labCA</SPAN> has been tested with <SPAN  CLASS="textbf">matlab</SPAN>-6.5, <SPAN  CLASS="textbf">matlab</SPAN>-7.0 and <SPAN  CLASS="textbf">scilab</SPAN>-2.7 .. <SPAN  CLASS="textbf">scilab</SPAN>-5.3
under a variety of EPICS releases up to 7.0.4.1 on <SPAN  CLASS="textbf">linux-x86</SPAN>,
<SPAN  CLASS="textbf">linux-ppc</SPAN>, <SPAN  CLASS="textbf">solaris-sparc-gnu</SPAN>,
<SPAN  CLASS="textbf">linux-x86_64</SPAN>, <SPAN  CLASS="textbf">solaris-sparc</SPAN>, <SPAN  CLASS="textbf">solaris-sparc64</SPAN>
and <SPAN  CLASS="textbf">win32/64</SPAN><A ID="tex2html12"
  HREF="#foot883"><SUP><SPAN CLASS="arabic">11</SPAN></SUP></A>.

<P>
Building the documentation (on- and off-line) requires the <SPAN  CLASS="textbf">pdflatex</SPAN>,
<SPAN  CLASS="textbf">latex2html</SPAN> and <SPAN  CLASS="textbf">lynx</SPAN> software. If any of these is missing then
<SPAN  CLASS="textbf">labCA</SPAN> is still built but no documentation is generated. Note that
tagged releases on github usually come with pre-built documentation.

<P>

<H3><A ID="SECTION00031200000000000000">
Configuration</A>
</H3>
Two files, `<SPAN style="font-family:monospace">configure/CONFIG</SPAN>' and `<SPAN style="font-family:monospace">configure/RELEASE</SPAN>' need to
be adapted to the user's installation:
<DL>
<DT><STRONG><SPAN style="font-family:monospace">CONFIG:</SPAN></STRONG></DT>
<DD>A handful of configuration parameters must be defined
in this file.
<DL>
<DT><STRONG><SPAN style="font-family:monospace">MAKEFOR:</SPAN></STRONG></DT>
<DD>Setting the <SPAN style="font-family:monospace">MAKEFOR</SPAN> variable
determines the target application program the interface library is
built for. Valid settings are <SPAN style="font-family:monospace">MAKEFOR=SCILAB</SPAN> or <SPAN style="font-family:monospace">MAKEFOR=MATLAB</SPAN>.
Any setting other than <SPAN style="font-family:monospace">MATLAB</SPAN> is treated like <SPAN style="font-family:monospace">SCILAB</SPAN>.

<P>
</DD>
<DT><STRONG><SPAN style="font-family:monospace">CONFIG_USE_CTRLC:</SPAN></STRONG></DT>
<DD>Set this to <SPAN style="font-family:monospace">YES</SPAN> or <SPAN style="font-family:monospace">NO</SPAN> to enable
or disable, respectively, code for handling &ldquo;Ctrl-C&rdquo; keystroke sequences.
When enabled, <SPAN  CLASS="textbf">labCA</SPAN> operations (<EM>except for</EM> <SPAN style="font-family:monospace">lcaDelay</SPAN>) may be aborted
by hitting &ldquo;Ctrl-C&rdquo;.
Note that <SPAN  CLASS="textbf">labCA</SPAN> polls for an &ldquo;abort condition&rdquo; with a granularity of the
<A HREF="node23.html#timeout"><SPAN  CLASS="textbf">ezca</SPAN> timeout parameter</A>.
Unfortunately, neither <SPAN  CLASS="textbf">matlab</SPAN> nor <SPAN  CLASS="textbf">scilab</SPAN> feature a documented API for handling
Ctrl-C events and therefore Ctrl-C support &mdash; the implementation using undocumented
features of <SPAN  CLASS="textbf">scilab</SPAN> and <SPAN  CLASS="textbf">matlab</SPAN> &mdash; must be considered &ldquo;experimental&rdquo;
i.e., it might cause problems on certain operating system and/or <SPAN  CLASS="textbf">scilab</SPAN>/<SPAN  CLASS="textbf">matlab</SPAN>
versions.

<P>
</DD>
<DT><STRONG><SPAN style="font-family:monospace">INSTALL_LOCATION:</SPAN></STRONG></DT>
<DD>Set this variable to install in a location
different from the <SPAN  CLASS="textbf">labCA</SPAN> top directory.
<EM>NOTE: This method has been deprecated.
Use <SPAN style="font-family:monospace">INSTALL_LOCATION_APP</SPAN> in the <SPAN style="font-family:monospace">RELEASE</SPAN> file
instead.</EM>
</DD>
</DL>
</DD>
<DT><STRONG><SPAN style="font-family:monospace">RELEASE:</SPAN></STRONG></DT>
<DD>In this file, paths to the EPICS base (`<SPAN style="font-family:monospace">EPICS_BASE</SPAN>'
variable) and <SPAN  CLASS="textbf">scilab</SPAN> (`<SPAN style="font-family:monospace">SCILABDIR</SPAN>' variable) or <SPAN  CLASS="textbf">matlab</SPAN> (`<SPAN style="font-family:monospace">MATLABDIR</SPAN>'
variable) installations must be specified.

<P>
Under <SPAN  CLASS="textbf">win32/64</SPAN>, an additional variable
`<SPAN style="font-family:monospace">MATLIB_SUBDIR</SPAN>' must be set directing the build process to select the correct
<SPAN style="font-family:monospace">libmx.lib</SPAN> and <SPAN style="font-family:monospace">libmex.lib</SPAN> library variants. The setting of this variable
is compiler dependent.
<DL>
<DT><STRONG><SPAN style="font-family:monospace">INSTALL_LOCATION_APP=&lt;path&gt;</SPAN></STRONG></DT>
<DD><SPAN style="font-family:monospace">&lt;path&gt;</SPAN> defining the
install location of the <SPAN  CLASS="textbf">labCA</SPAN> package. If unset, the <SPAN  CLASS="textbf">labCA</SPAN> <SPAN style="font-family:monospace">TOP</SPAN>
directory will be used.
</DD>
<DT><STRONG><SPAN style="font-family:monospace">MATLABDIR=&lt;path&gt;</SPAN></STRONG></DT>
<DD><SPAN style="font-family:monospace">&lt;path&gt;</SPAN> defining the <SPAN  CLASS="textbf">matlab</SPAN> installation
directory where the `<SPAN style="font-family:monospace">extern</SPAN>' subdirectory can be found (e.g.
<SPAN style="font-family:monospace">/opt/matlabR14beta2</SPAN>).
</DD>
<DT><STRONG><SPAN style="font-family:monospace">SCILABDIR=&lt;path&gt;</SPAN></STRONG></DT>
<DD><SPAN style="font-family:monospace">&lt;path&gt;</SPAN> defining the <SPAN  CLASS="textbf">scilab</SPAN> installation
directory where the `<SPAN style="font-family:monospace">routines</SPAN>' subdirectory can be found (e.g.
<SPAN style="font-family:monospace">/usr/lib/scilab-2.7</SPAN>). However, <SPAN  CLASS="textbf">scilab</SPAN>-5 does not use a <SPAN style="font-family:monospace">routines</SPAN>
subdirectory anymore. <SPAN style="font-family:monospace">SCILABDIR</SPAN> must point to the directory where
relevant headers such as <SPAN style="font-family:monospace">mex.h</SPAN> etc. are found under
<SPAN style="font-family:monospace">$(SCILABDIR)/include/scilab/</SPAN>. E.g., if there is <SPAN style="font-family:monospace">/usr/include/scilab/mex.h</SPAN> then set <SPAN style="font-family:monospace">SCILABDIR=/usr</SPAN>.
</DD>
<DT><STRONG><SPAN style="font-family:monospace">MATLIB_SUBDIR=&lt;pathelem&gt;</SPAN></STRONG></DT>
<DD><SPAN style="font-family:monospace">&lt;pathelem&gt;</SPAN> chosing the subdirectory
corresponding to the C-compiler that is used for the build. (e.g. 
<SPAN style="font-family:monospace">win32/microsoft/msvc60</SPAN> for the microsoft visual c++ 6.0 compiler).
The <SPAN style="font-family:monospace">libmex.lib</SPAN> and <SPAN style="font-family:monospace">libmx.lib</SPAN> files for the applicable compiler
are found there.
</DD>
</DL>
</DD>
</DL>
Any irrelevant variables (such as <SPAN style="font-family:monospace">MATLABDIR</SPAN> if <SPAN style="font-family:monospace">MAKEFOR=SCILAB</SPAN>)
are ignored.

<P>
Note that the EPICS build system has problems with path names containing
white space as they are commonly used on <SPAN  CLASS="textbf">win32/64</SPAN>. Although I have
tried to work around this, you still might encounter problems. I found
that setting the environment variable <SPAN style="font-family:monospace">MATLAB</SPAN> to point to the <SPAN  CLASS="textbf">matlab</SPAN>
directory helped (<SPAN  CLASS="textbf">cygwin</SPAN>). It is best to avoid white space in path
names, however. This can be achieved by using symbolic links under recent
<SPAN  CLASS="textbf">win32/64</SPAN>(but this unfortunately requires special privileges), re-mounting
as a network drive or simpy copying relevant headers and libraries
to a secondary, white-space free &ldquo;work-directory hierarchy&rdquo;.

<P>

<H3><A ID="SECTION00031300000000000000">
Building <SPAN  CLASS="textbf">labCA</SPAN></A>
</H3>
After setting the
`<SPAN style="font-family:monospace">EPICS_HOST_ARCH</SPAN>' environment variable, <SPAN  CLASS="textbf">GNU</SPAN> make is invoked from the <SPAN  CLASS="textbf">labCA</SPAN> top 
directory. Note that the compiler toolchain must be found in the system
<SPAN style="font-family:monospace">PATH</SPAN><A ID="tex2html13"
  HREF="#foot886"><SUP><SPAN CLASS="arabic">12</SPAN></SUP></A>.

<P>
<BR><HR><H4>Footnotes</H4>
<DL>
<DT><A ID="foot882">... enabled</A><A
 HREF="node29.html#tex2html11"><SUP><SPAN CLASS="arabic">10</SPAN></SUP></A></DT>
<DD>
To be precise: only <SPAN  CLASS="textbf">labCA</SPAN> needs to be a shared library (but must then have
EPICS BASE linked in); we recommend an EPICS BASE installation with
shared libraries enabled because modifications to the EPICS Makefiles
are required to build a shared <SPAN  CLASS="textbf">labCA</SPAN> library that is linked against
static versions of EPICS BASE.

</DD>
<DT><A ID="foot883">...win32/64</A><A
 HREF="node29.html#tex2html12"><SUP><SPAN CLASS="arabic">11</SPAN></SUP></A></DT>
<DD>
Note that not all possible combinations have been tested with the latest <SPAN  CLASS="textbf">labCA</SPAN> release
but rather the latest versions of the respective components on the platforms
that are in the distribution.

</DD>
<DT><A ID="foot886">... style="font-family:monospace">PATH</SPAN></A><A
 HREF="node29.html#tex2html13"><SUP><SPAN CLASS="arabic">12</SPAN></SUP></A></DT>
<DD>
Under <SPAN  CLASS="textbf">win32/64</SPAN>, the <SPAN  CLASS="textbf">msvc</SPAN> compiler features a <SPAN style="font-family:monospace">.BAT</SPAN> file for
setting up the necessary environment.


</DD>
</DL>
<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A
 HREF="node30.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node28.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node28.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A
 HREF="node30.html">Using labCA</A>
<B> Up:</B> <A
 HREF="node28.html">Building and Using labCA</A>
<B> Previous:</B> <A
 HREF="node28.html">Building and Using labCA</A></DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
